services:
  open-webui:
    container_name: 'open-webui'
    image: 'ghcr.io/open-webui/open-webui:main'
    restart: 'unless-stopped'
    networks:
      - 'default-frontend'
    volumes:
      - '/etc/localtime:/etc/localtime:ro'
      - 'open-webui-data:/app/backend/data'
    environment:
      WEBUI_SECRET_KEY: '${OPEN_WEBUI_SECRET_KEY}'
      DATABASE_TYPE: 'postgresql'
      DATABASE_HOST: '${OPEN_WEBUI_POSTGRES_SERVER}'
      DATABASE_USER: '${OPEN_WEBUI_POSTGRES_USER}'
      DATABASE_PASSWORD: '${OPEN_WEBUI_POSTGRES_PASSWORD}'
      DATABASE_NAME: '${OPEN_WEBUI_POSTGRES_DATABASE}'
      DATABASE_PORT: '${OPEN_WEBUI_POSTGRES_PORT}'
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.open-webui.rule=Host(`${OPEN_WEBUI_DOMAIN}`)'
      - 'traefik.http.routers.open-webui.entrypoints=websecure'
      - 'traefik.http.routers.open-webui.tls=true'
      - 'traefik.http.routers.open-webui.tls.certresolver=letsencrypt'
      - 'traefik.http.routers.open-webui.tls.domains[0].main=${OPEN_WEBUI_DOMAIN}'
      - 'traefik.http.routers.open-webui.middlewares=intranet@file'
      - 'traefik.http.services.open-webui.loadbalancer.server.port=8080'

volumes:
  open-webui-data:
    external: true

networks:
  default-frontend:
    external: true
